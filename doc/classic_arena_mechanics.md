# Классическая арена — как устроена игра на пальцах

## 1. Подбор пары
1. Пользователь нажимает «Арена».
2. Бот смотрит в общий список каналов и выбирает те, у кого наименьшее число сыгранных дуэлей.
3. Из этой «первой корзины» берутся две карточки с максимально близкими рейтингами. Если пар уже было много, бот старается не показывать одну и ту же комбинацию одному пользователю дважды подряд.

## 2. Запуск дуэли
1. Для найденной пары бот резервирует одноразовый токен — это защита от повторного нажатия кнопок.
2. В чат отправляется сообщение с описанием двух каналов, мини-справкой и тремя кнопками: выбрать A, выбрать B, ничья.
3. Дополнительно прикрепляется картинка, где оба аватара стоят по бокам, между ними — «VS».

## 3. Обработка голоса
1. Пользователь нажимает любую из кнопок. Токен проверяется, чтобы убедиться, что голос ещё не считали.
2. Бот фиксирует исход:  
   - Победитель получает прибавку рейтинга, его счётчик побед растёт.  
   - Проигравший теряет немного рейтинга и получает поражение.  
   - При ничьей оба участника смещаются к среднему рейтингу и просто добавляют по игре без побед/поражений.
3. В базу попадает запись с деталями матча (кто играл, какой был рейтинг до/после, когда произошла дуэль).

## 4. Награды и продолжение
1. После голосования бот смотрит, сколько классических игр у пользователя:  
   - После 350 игр выдаётся первая секретная ссылка.  
   - После 700 игр — вторая.  
   Награда показывается вместо нового дуэля один раз на каждый порог.
2. Если награды нет, бот тут же подбирает новую пару и отправляет следующий дуэль.

## 5. Почему это работает
- Постоянное сравнение рейтингов поддерживает честное распределение: сильные каналы чаще встречают равных соперников.
- Одноразовые токены предотвращают накрутки.
- Сохранение истории игр позволяет строить топы, статистику и выдавать награды верным игрокам.

Так в двух словах устроена классическая арена: выбираем соперников, слушаем голос, обновляем рейтинг — и сразу следующий бой.
